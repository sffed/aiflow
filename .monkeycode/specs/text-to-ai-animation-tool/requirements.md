# 需求文档

## 引言

本系统是一个文本到AI动画生成工具，允许用户通过文本输入创建动画序列。系统能够处理文本段落，使用AI模型生成绘图提示词，为每段文本生成多张图片选项，并支持图生图模式以保持上下文一致性。

## 词汇表

- **文本段落**：用户输入或导入的文本片段，作为生成动画的单元
- **绘图提示词**：由AI模型从文本生成的，用于指导图片生成的描述性文本
- **图生图模式**：使用已有图片作为参考来生成新图片的模式
- **动画序列**：按顺序排列的一组图片，形成连续的动画效果
- **上下文一致性**：相邻帧图片在风格、内容上的连贯性
- **通用大语言模型**：支持OpenAI GPT-4、Anthropic Claude等通用大语言模型
- **Stable Diffusion模型**：开源的扩散模型，包括SD XL、SD 3等版本
- **图片生成数量**：每段文本生成的图片变体数量，由用户自定义配置
- **语音文件**：由文本转语音API生成或用户上传的音频文件
- **TTS生成**：使用文本转语音API自动生成语音文件的方式
- **本地上传**：用户从本地设备上传已有音频文件的方式
- **文本转语音模型**：支持OpenAI TTS、Azure Speech、Google Cloud TTS等多种语音合成模型
- **音轨**：视频中与图片同步播放的音频轨道
- **视频合成**：将图片序列和音频轨道合并为最终视频文件的过程
- **项目文件**：包含所有文本、图片、语音、配置等数据的完整动画项目文件
- **时间轴**：显示和编辑动画序列中各帧的显示时长和顺序的界面组件
- **字幕**：在视频画面上显示的文本内容，用于说明当前段落内容
- **过渡效果**：相邻图片帧之间的切换动画效果

## 需求

### 需求1：文本输入功能

**用户故事：** AS[动画创作者]，我想要通过导入文件或手动输入的方式提供文本内容，以便开始创建动画序列。

#### Acceptance Criteria

1. WHEN 用户点击"导入文本"按钮时，系统 SHALL 提供文件选择对话框支持 txt、md、docx 格式文件
2. WHEN 用户选择并导入文本文件时，系统 SHALL 解析文件内容并将文本按段落分割显示在界面上
3. WHEN 用户手动输入文本时，系统 SHALL 提供多行文本输入框支持用户输入或粘贴内容
4. WHEN 用户提交文本时，系统 SHALL 按换行符或段落数自动识别文本段落
5. IF 用户输入的文本为空时，系统 SHALL 显示提示信息要求用户输入内容

### 需求2：文本到绘图提示词的AI处理

**用户故事：** AS[动画创作者]，我想要系统能够自动将文本转换为适合绘图的提示词，以便生成高质量的图片。

#### Acceptance Criteria

1. WHEN 用户提交文本段落时，系统 SHALL 调用通用大语言模型或自定义文本处理API将文本转换为绘图提示词
2. WHILE 文本处理模型运行时，系统 SHALL 显示处理进度和状态指示器
3. IF 文本处理API调用失败时，系统 SHALL 显示错误信息并提供重试选项
4. IF 文本处理模型返回的提示词为空或无效时，系统 SHALL 提示用户并提供手动编辑功能
5. WHEN 文本处理完成后，系统 SHALL 显示生成的绘图提示词并允许用户查看和编辑
6. WHEN 用户配置文本处理API时，系统 SHALL 支持OpenAI GPT-4、Anthropic Claude等通用大语言模型
7. WHEN 用户配置自定义API时，系统 SHALL 支持输入自定义的API端点URL和认证密钥

### 需求3：多图片生成与选择

**用户故事：** AS[动画创作者]，我想要为每段文本生成多张不同风格的图片以供选择，以便挑选最符合预期的图片。

#### Acceptance Criteria

1. WHEN 用户确认绘图提示词后，系统 SHALL 调用图片生成API生成用户指定数量的不同变体图片
2. WHILE 图片生成过程中，系统 SHALL 显示生成进度和预计完成时间
3. WHEN 图片生成完成后，系统 SHALL 将所有生成的图片以网格形式展示供用户浏览
4. WHEN 用户点击某张图片时，系统 SHALL 放大显示该图片以便详细查看
5. WHEN 用户选择一张图片后，系统 SHALL 标记该图片为当前段落的最终选择并锁定选择
6. WHEN 用户配置图片生成数量时，系统 SHALL 接受1到10张之间的整数值

### 需求4：图片尺寸配置

**用户故事：** AS[动画创作者]，我想要自定义生成图片的尺寸参数，以便适配不同的展示场景。

#### Acceptance Criteria

1. WHEN 用户打开设置面板时，系统 SHALL 显示图片尺寸配置选项
2. WHEN 用户配置图片宽度时，系统 SHALL 接受256到4096像素之间的整数值
3. WHEN 用户配置图片高度时，系统 SHALL 接受256到4096像素之间的整数值
4. WHILE 用户输入尺寸值时，系统 SHALL 实时验证输入范围并提供即时反馈
5. IF 用户输入的尺寸值超出范围时，系统 SHALL 显示错误提示并使用最接近的有效值

### 需求5：图生图上下文一致性

**用户故事：** AS[动画创作者]，我想要后续生成的图片能够参考前一张已选图片的风格，以便保持动画的视觉连贯性。

#### Acceptance Criteria

1. WHEN 用户开始生成下一段文本的图片时，系统 SHALL 自动将上一段文本已选的图片作为参考图
2. WHILE 使用图生图模式时，系统 SHALL 设置适当的参考强度参数（默认值为0.5）
3. WHEN 用户调整参考强度参数时，系统 SHALL 在0到1之间接受调整
4. WHILE 图生图模式下生成图片时，系统 SHALL 在生成的每张图片中保持前一张图片的风格特征
5. IF 用户不希望使用图生图模式时，系统 SHALL 提供选项允许禁用该功能

### 需求6：API服务配置

**用户故事：** AS[动画创作者]，我想要配置文本处理、图片生成和语音合成模型的API服务，以便选择使用远程API或本地部署的服务。

#### Acceptance Criteria

1. WHEN 用户打开API配置面板时，系统 SHALL 显示文本处理模型、图片生成模型和语音合成模型的配置选项
2. WHEN 用户配置文本处理API时，系统 SHALL 支持输入API端点URL和认证密钥
3. WHEN 用户配置图片生成API时，系统 SHALL 支持输入API端点URL、认证密钥和模型名称
4. WHEN 用户配置语音合成API时，系统 SHALL 支持输入API端点URL、认证密钥和语音模型名称
5. WHILE 用户使用本地API服务时，系统 SHALL 支持配置本地服务的地址和端口
6. WHEN 用户保存API配置后，系统 SHALL 验证配置的有效性并显示连接状态
7. WHEN 用户选择图片生成模型时，系统 SHALL 支持Stable Diffusion系列、Midjourney API、其他开源模型或自定义API
8. WHILE 用户使用Stable Diffusion模型时，系统 SHALL 支持配置模型版本（如SD XL、SD 3等）
9. WHEN 用户配置Midjourney API时，系统 SHALL 支持配置API端点和必要的认证参数
10. WHEN 用户选择语音合成模型时，系统 SHALL 支持OpenAI TTS、Azure Speech、Google Cloud TTS、ElevenLabs或自定义API
11. WHILE 用户配置语音合成时，系统 SHALL 支持选择语音类型、语速、音调和音量参数

### 需求7：文本转语音功能

**用户故事：** AS[动画创作者]，我想要将文本段落转换为语音文件或上传本地音频文件，以便为动画添加配音效果。

#### Acceptance Criteria

1. WHEN 用户为文本段落生成图片时，系统 SHALL 提供两种语音获取选项：TTS生成和本地上传
2. WHEN 用户选择TTS生成时，系统 SHALL 调用文本转语音API将文本段落转换为音频文件
3. WHEN 用户选择本地上传时，系统 SHALL 提供文件选择对话框支持用户选择本地音频文件
4. WHILE 用户上传音频文件时，系统 SHALL 支持MP3、WAV、M4A、FLAC、OGG等常见音频格式
5. WHILE TTS语音生成过程中，系统 SHALL 显示生成进度和预计完成时间
6. WHEN 语音文件生成或上传完成后，系统 SHALL 将音频文件与对应的文本段落和图片关联
7. WHEN 用户点击音频播放按钮时，系统 SHALL 播放语音文件
8. IF 文本转语音API调用失败时，系统 SHALL 显示错误信息并提供重试选项
9. WHEN 用户配置TTS语音参数时，系统 SHALL 支持选择语音类型、语速、音调和音量
10. WHILE 用户播放语音文件时，系统 SHALL 显示音频波形和播放进度
11. IF 用户上传的音频文件格式不支持时，系统 SHALL 显示错误提示并列出支持的格式
12. WHEN 用户替换语音文件时，系统 SHALL 支持重新选择TTS生成或本地上传

### 需求8：语音插入动画序列

**用户故事：** AS[动画创作者]，我想要将语音文件插入到指定的动画序列中，以便音频与画面同步播放。

#### Acceptance Criteria

1. WHEN 用户在动画序列中选择某个文本段落时，系统 SHALL 显示该段落关联的语音文件状态
2. WHEN 用户选择插入语音到动画序列时，系统 SHALL 提供两种语音来源选项：TTS生成和本地上传
3. WHEN 用户选择TTS生成时，系统 SHALL 将语音文件与对应的图片帧绑定
4. WHEN 用户选择本地上传时，系统 SHALL 提供文件选择对话框支持用户选择本地音频文件
5. WHILE 用户上传音频文件时，系统 SHALL 支持MP3、WAV、M4A、FLAC、OGG等常见音频格式
6. WHEN 用户上传音频文件后，系统 SHALL 将该文件与对应的文本段落和图片帧绑定
7. WHILE 语音与图片绑定时，系统 SHALL 允许用户设置音频与图片的同步时长
8. WHEN 用户查看动画序列时，系统 SHALL 在时间轴上显示音频轨道与图片帧的对应关系
9. WHEN 用户调整音频播放时长时，系统 SHALL 提供拖拽调整功能并实时预览
10. IF 某个文本段落没有关联的语音文件时，系统 SHALL 在时间轴上显示静音标记
11. WHEN用户删除语音文件时，系统 SHALL 从动画序列中移除对应的音轨
12. WHILE 用户预览动画时，系统 SHALL 同步播放音频和图片
13. IF 用户上传的音频文件格式不支持时，系统 SHALL 显示错误提示并列出支持的格式
14. WHEN 用户上传的音频文件时长与文本不匹配时，系统 SHALL 提示用户并提供调整选项

### 需求9：项目管理功能

**用户故事：** AS[动画创作者]，我想要保存、打开和管理我的动画项目，以便随时继续编辑已完成的工作。

#### Acceptance Criteria

1. WHEN 用户创建新项目时，系统 SHALL 提供项目名称输入和存储位置选择
2. WHEN 用户保存项目时，系统 SHALL 将所有文本段落、已选图片、语音文件、配置参数等信息保存为项目文件
3. WHEN 用户打开已有项目时，系统 SHALL 加载项目的所有数据并恢复到上次编辑的状态
4. WHILE 用户编辑项目时，系统 SHALL 支持自动保存功能防止数据丢失
5. WHEN 用户关闭项目时，系统 SHALL 检查是否有未保存的更改并提示用户保存
6. WHEN 用户浏览项目列表时，系统 SHALL 显示项目名称、创建时间、最后修改时间和项目缩略图
7. WHEN 用户删除项目时，系统 SHALL 显示确认对话框并在确认后删除项目文件
8. WHEN 用户重命名项目时，系统 SHALL 更新项目文件的名称
9. IF 项目文件损坏或无法加载时，系统 SHALL 显示错误信息并提供恢复建议
10. WHILE 用户导出项目时，系统 SHALL 支持将项目打包为独立文件以便分享

### 需求10：动画预览功能

**用户故事：** AS[动画创作者]，我想要在生成最终视频前预览动画序列的播放效果，以便及时发现问题并进行调整。

#### Acceptance Criteria

1. WHEN 用户点击预览按钮时，系统 SHALL 按时间轴顺序播放所有图片序列
2. WHILE 预览播放时，系统 SHALL 同步播放关联的语音文件
3. WHEN 用户暂停预览时，系统 SHALL 停止在当前帧并允许用户继续或退出
4. WHEN 用户调整预览速度时，系统 SHALL 支持0.5倍、1倍、1.5倍、2倍速播放
5. WHILE 预览播放时，系统 SHALL 显示当前帧的序号和总帧数
6. WHEN 用户点击某个时间轴位置时，系统 SHALL 从该位置开始预览
7. WHILE 预览播放时，系统 SHALL 显示播放进度条和时间指示器
8. WHEN 用户选择循环预览时，系统 SHALL 在播放结束后自动从头开始
9. IF 某个段落缺少图片或语音时，系统 SHALL 在预览时跳过该段落或显示占位符
10. WHILE 用户全屏预览时，系统 SHALL 支持按ESC键退出全屏模式

### 需求11：字幕功能

**用户故事：** AS[动画创作者]，我想要将文本段落作为字幕添加到视频画面中，以便观众能够清楚理解动画内容。

#### Acceptance Criteria

1. WHEN 用户为文本段落生成图片时，系统 SHALL 自动为该段落创建字幕内容
2. WHEN 用户启用字幕功能时，系统 SHALL 将对应的文本段落显示在视频画面上
3. WHILE 用户编辑字幕时，系统 SHALL 支持修改字幕文本内容
4. WHEN 用户配置字幕样式时，系统 SHALL 支持设置字体、大小、颜色、位置和背景
5. WHILE 字幕与图片绑定时，系统 SHALL 允许用户设置字幕的开始和结束时间
6. WHEN 用户预览动画时，系统 SHALL 在对应的时间段显示字幕
7. IF 用户选择不显示字幕时，系统 SHALL 在视频生成时排除字幕元素
8. WHEN 用户调整字幕位置时，系统 SHALL 支持拖拽字幕到画面的任意位置
9. WHILE 用户设置字幕动画时，系统 SHALL 支持淡入、淡出、滑动等过渡效果
10. WHEN 语音文件与字幕同步时，系统 SHALL 自动调整字幕显示时长与语音时长匹配
11. IF 文本段落过长时，系统 SHALL 支持自动换行或分段显示字幕

### 需求12：动画序列导出

**用户故事：** AS[动画创作者]，我想要将最终选择的图片序列导出为动画文件，以便分享和使用生成的动画。

#### Acceptance Criteria

1. WHEN 所有文本段落都完成图片选择后，系统 SHALL 提供导出动画的选项
2. WHEN 用户选择导出功能时，系统 SHALL 显示导出格式选项（GIF、MP4、WebM）
3. WHEN 用户配置导出参数（帧率、分辨率、质量）时，系统 SHALL 应用这些参数到导出过程
4. WHILE 导出过程中，系统 SHALL 显示导出进度和预计完成时间
5. WHEN 导出完成时，系统 SHALL 提供下载链接或保存文件到指定位置

### 需求13：视频生成与保存

**用户故事：** AS[动画创作者]，我想要将图片序列、语音文件和字幕合成为完整的视频，以便创建有声带字幕的动画作品。

#### Acceptance Criteria

1. WHEN 用户点击"生成视频"按钮时，系统 SHALL 检查所有文本段落是否都已完成图片选择
2. IF 存在未完成图片选择的文本段落时，系统 SHALL 提示用户完成所有图片选择后再生成视频
3. WHEN 用户确认生成视频时，系统 SHALL 将图片序列、关联的语音文件和字幕进行合成
4. WHILE 视频合成过程中，系统 SHALL 显示合成进度和预计完成时间
5. WHEN 视频合成完成后，系统 SHALL 支持在界面中预览生成的视频
6. WHEN 用户选择保存视频时，系统 SHALL 提供保存位置选择和文件名输入
7. WHILE 视频保存时，系统 SHALL 支持选择视频格式（MP4、MOV、AVI）和编码参数
8. WHEN 视频保存完成后，系统 SHALL 显示保存成功的提示并提供播放选项
9. IF 语音文件与图片时长不匹配时，系统 SHALL 自动调整音频循环或图片显示时长
10. WHEN 用户配置视频参数时，系统 SHALL 支持设置分辨率、帧率、比特率和音频质量
11. WHILE 视频合成时，系统 SHALL 将字幕渲染到视频画面中
12. WHEN 用户选择视频质量时，系统 SHALL 提供低、中、高三种预设选项

### 需求14：时间轴编辑功能

**用户故事：** AS[动画创作者]，我想要在时间轴上精确编辑每张图片的显示时长和过渡效果，以便控制动画的节奏。

#### Acceptance Criteria

1. WHEN 用户查看动画序列时，系统 SHALL 在时间轴上显示所有图片帧的排列和时长
2. WHEN 用户点击某个图片帧时，系统 SHALL 在时间轴上高亮显示该帧并显示详细信息
3. WHEN 用户拖拽调整图片帧的显示时长时，系统 SHALL 实时更新时长预览
4. WHILE 用户调整时长时，系统 SHALL 显示当前时长和总时长的信息
5. WHEN 用户选择过渡效果时，系统 SHALL 提供淡入淡出、滑动、缩放等过渡选项
6. WHILE 用户配置过渡效果时，系统 SHALL 支持设置过渡持续时间（0.1秒到2秒）
7. WHEN用户拖拽图片帧时，系统 SHALL 允许用户调整图片帧的播放顺序
8. WHILE 用户编辑时间轴时，系统 SHALL 支持撤销和重做操作
9. WHEN 用户选择某个图片帧时，系统 SHALL 在侧边栏显示该帧的属性编辑选项
10. IF 某个图片帧的时长设置过短时，系统 SHALL 提示用户该帧可能无法清晰显示
11. WHEN 用户复制某个图片帧时，系统 SHALL 支持粘贴到时间轴的其他位置
12. WHILE 用户查看时间轴时，系统 SHALL 显示语音轨道和字幕轨道与图片帧的对应关系
13. WHEN 用户调整语音轨道时，系统 SHALL 支持拖拽调整音频的开始和结束时间
14. WHEN用户调整字幕轨道时，系统 SHALL 支持拖拽调整字幕的显示时间段

### 需求15：批量文本文件导入

**用户故事：** AS[动画创作者]，我想要批量导入多个文本文件，以便一次性处理多个故事或脚本。

#### Acceptance Criteria

1. WHEN 用户选择批量导入功能时，系统 SHALL 提供多文件选择对话框支持用户选择多个文本文件
2. WHEN 用户导入多个文本文件时，系统 SHALL 为每个文件创建独立的动画项目
3. WHILE 批量导入过程中，系统 SHALL 显示当前处理的文件和总体进度
4. WHEN 批量导入完成后，系统 SHALL 在项目列表中显示所有导入的项目
5. IF 某个文件导入失败时，系统 SHALL 记录错误信息并继续处理其他文件



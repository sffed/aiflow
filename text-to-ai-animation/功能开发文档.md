# åŠŸèƒ½å¼€å‘æ–‡æ¡£

## æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£è®°å½• AI åŠ¨ç”»ç”Ÿæˆå·¥å…·å·²å®ç°çš„åŠŸèƒ½åŠå…¶å®ç°ç»†èŠ‚ã€‚

---

## å·²å®ç°åŠŸèƒ½

### 1. é¡¹ç›®ç®¡ç†åŠŸèƒ½

#### 1.1 åˆ›å»ºæ–°é¡¹ç›®
**åŠŸèƒ½æè¿°**ï¼šç”¨æˆ·å¯ä»¥é€šè¿‡è¾“å…¥æ–‡æœ¬åˆ›å»ºæ–°çš„åŠ¨ç”»é¡¹ç›®

**å®ç°ç»†èŠ‚**ï¼š
- ç»„ä»¶ï¼š`TextInputPanel.tsx`
- æ”¯æŒä¸¤ç§æ¨¡å¼ï¼š
  - `create` æ¨¡å¼ï¼šæ˜¾ç¤ºé¡¹ç›®åç§°è¾“å…¥æ¡†ï¼Œåˆ›å»ºæ–°é¡¹ç›®
  - `add` æ¨¡å¼ï¼šä¸æ˜¾ç¤ºé¡¹ç›®åç§°ï¼Œç›´æ¥æ·»åŠ åˆ°å½“å‰é¡¹ç›®
- æ”¯æŒæ–‡ä»¶å¯¼å…¥ï¼š`.txt`ã€`.md`ã€`.docx`
- æ”¯æŒæ‰‹åŠ¨è¾“å…¥æ–‡æœ¬
- æ¯è¡Œæ–‡æœ¬è‡ªåŠ¨åˆ†å‰²ä¸ºä¸€ä¸ªæ®µè½

**å…³é”®ä»£ç **ï¼š
```typescript
const handleCreateProject = () => {
  if (!text.trim()) return

  if (mode === 'create' && !projectName.trim()) return

  const lines = text.split('\n').filter(line => line.trim())

  const segments: TextSegment[] = lines.map((line, index) => ({
    id: `segment_${Date.now()}_${index}`,
    text: line.trim(),
    generatedImages: [],
    duration: 3
  }))

  if (mode === 'create') {
    const newProject = {
      id: `project_${Date.now()}`,
      name: projectName.trim(),
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString(),
      segments: [],
      settings: { ... },
      apiConfig: undefined
    }

    setProject(newProject)
    addSegments(segments)
  } else {
    addSegments(segments)
  }

  onClose()
}
```

---

### 2. æ–‡æœ¬æ®µè½ç®¡ç†

#### 2.1 æ·»åŠ æ–‡æœ¬æ®µè½
**åŠŸèƒ½æè¿°**ï¼šåœ¨ç°æœ‰é¡¹ç›®ä¸­æ·»åŠ æ–°çš„æ–‡æœ¬æ®µè½

**å®ç°ç»†èŠ‚**ï¼š
- ç»„ä»¶ï¼š`TextInputPanel.tsx` (mode='add')
- æ®µè½è‡ªåŠ¨æ·»åŠ åˆ°é¡¹ç›®æœ€å
- æ”¯æŒæ‰¹é‡æ·»åŠ ï¼ˆå¤šè¡Œæ–‡æœ¬ï¼‰
- è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€æ®µè½ID

---

### 3. ç»˜å›¾æç¤ºè¯ç”Ÿæˆ

#### 3.1 AI ç”Ÿæˆæç¤ºè¯
**åŠŸèƒ½æè¿°**ï¼šä½¿ç”¨ AI å°†æ–‡æœ¬è½¬æ¢ä¸ºé€‚åˆå›¾ç‰‡ç”Ÿæˆçš„æç¤ºè¯

**å®ç°ç»†èŠ‚**ï¼š
- API æœåŠ¡ï¼š`APIService.ts`
- æ”¯æŒçš„æä¾›å•†ï¼š
  - OpenAI (GPT-4)
  - Anthropic (Claude)
  - æ™ºè°±AI (GLM-4.5)
  - è‡ªå®šä¹‰ API
- è°ƒè¯•æ—¥å¿—ï¼šè®°å½• API è°ƒç”¨ã€è¯·æ±‚ã€å“åº”å’Œé”™è¯¯

**æ™ºè°±AI å®ç°**ï¼š
```typescript
private async callZhipu(config: any, text: string): Promise<string> {
  const response = await fetch(config.endpoint, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${config.apiKey}`
    },
    body: JSON.stringify({
      model: config.model,
      messages: [
        {
          role: 'system',
          content: 'ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„AIç»˜ç”»æç¤ºè¯ç”Ÿæˆä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯å°†æ–‡æœ¬è½¬æ¢ä¸ºç®€æ´ã€å‡†ç¡®ã€å¯Œæœ‰ç”»é¢æ„Ÿçš„è‹±æ–‡ç»˜ç”»æç¤ºè¯ã€‚åªè¾“å‡ºæç¤ºè¯æœ¬èº«ï¼Œä¸è¦åŒ…å«ä»»ä½•è§£é‡Šã€åˆ†ææˆ–å¤šä¸ªé€‰é¡¹ã€‚'
        },
        {
          role: 'user',
          content: text
        }
      ],
      max_tokens: 200,
      temperature: 0.7
    })
  })

  const data = await response.json()
  return data.choices[0].message.content.trim()
}
```

**æç¤ºè¯æ˜¾ç¤º**ï¼š
- ç»„ä»¶ï¼š`TextSegmentCard.tsx`
- ä½¿ç”¨ `useEffect` ç›‘å¬ `segment.prompt` å˜åŒ–
- è‡ªåŠ¨æ›´æ–°è¾“å…¥æ¡†æ˜¾ç¤º

---

### 4. å›¾ç‰‡ç”Ÿæˆ

#### 4.1 AI ç”Ÿæˆå›¾ç‰‡
**åŠŸèƒ½æè¿°**ï¼šæ ¹æ®æç¤ºè¯ç”Ÿæˆå¤šå¼ å›¾ç‰‡ä¾›ç”¨æˆ·é€‰æ‹©

**å®ç°ç»†èŠ‚**ï¼š
- ç»„ä»¶ï¼š`TextSegmentCard.tsx`, `SegmentList.tsx`
- æ”¯æŒçš„æä¾›å•†ï¼š
  - Stable Diffusion
  - Midjourney
  - æ™ºè°±AI (GLM-Image)
  - è‡ªå®šä¹‰ API
- ç”Ÿæˆå‚æ•°ï¼š
  - æ•°é‡ï¼š1/2/4/8 å¼ å¯é€‰
  - å°ºå¯¸ï¼š512x512ã€768x768ã€1024x768ã€1024x1024ã€1280x720ã€1280x1280 å¯é€‰
- å›¾ç”Ÿå›¾æ¨¡å¼ï¼šæ”¯æŒä½¿ç”¨ä¸Šä¸€æ®µè½å·²é€‰å›¾ç‰‡ä½œä¸ºå‚è€ƒ

**æ™ºè°±AI æ–‡ç”Ÿå›¾å®ç°**ï¼š
```typescript
private async callZhipuImage(
  config: any,
  prompt: string,
  count: number,
  width: number,
  height: number
): Promise<GeneratedImage[]> {
  const images: GeneratedImage[] = []

  for (let i = 0; i < count; i++) {
    const response = await fetch(config.endpoint, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${config.apiKey}`
      },
      body: JSON.stringify({
        model: config.model,
        prompt: prompt,
        size: `${width}x${height}`
      })
    })

    const data = await response.json()
    const imageUrl = data.data?.[0]?.url || data.url || data.image?.url

    images.push({
      id: `img_${Date.now()}_${i}`,
      url: imageUrl,
      data: imageUrl
    })
  }

  return images
}
```

**è°ƒè¯•æ—¥å¿—**ï¼š
- `[API] å¼€å§‹ç”Ÿæˆå›¾ç‰‡`
- `[API] è°ƒç”¨æ™ºè°±AIæ–‡ç”Ÿå›¾`
- `[API] ç”Ÿæˆå›¾ç‰‡è¿›åº¦: x/n`
- `[API] å›¾ç‰‡ x ç”ŸæˆæˆåŠŸ`
- `[API] å›¾ç‰‡ç”ŸæˆæˆåŠŸ`

---

### 5. API é…ç½®

#### 5.1 API é…ç½®ç®¡ç†
**åŠŸèƒ½æè¿°**ï¼šé…ç½®å„ç§ AI æœåŠ¡çš„ API ä¿¡æ¯

**å®ç°ç»†èŠ‚**ï¼š
- ç»„ä»¶ï¼š`APIConfigDialog.tsx`
- é…ç½®é¡¹ï¼š
  - æ–‡æœ¬åˆ°æç¤ºè¯ API
  - å›¾ç‰‡ç”Ÿæˆ API
  - æ–‡æœ¬è½¬è¯­éŸ³ API
- æ”¯æŒçš„æä¾›å•†ï¼š
  - æ–‡æœ¬åˆ°æç¤ºè¯ï¼šOpenAIã€Anthropicã€æ™ºè°±AIã€è‡ªå®šä¹‰
  - å›¾ç‰‡ç”Ÿæˆï¼šStable Diffusionã€Midjourneyã€æ™ºè°±AIã€è‡ªå®šä¹‰
  - æ–‡æœ¬è½¬è¯­éŸ³ï¼šOpenAIã€Azureã€Googleã€ElevenLabsã€è‡ªå®šä¹‰

**é»˜è®¤é…ç½®**ï¼š
```typescript
const defaultApiConfig: APIConfig = {
  textToPrompt: {
    provider: 'zhipu',
    apiKey: '',
    endpoint: 'https://open.bigmodel.cn/api/paas/v4/chat/completions',
    model: 'glm-4.5'
  },
  imageGeneration: {
    provider: 'zhipu',
    apiKey: '',
    endpoint: 'https://open.bigmodel.cn/api/paas/v4/images/generations',
    model: 'glm-image'
  },
  textToSpeech: {
    provider: 'openai',
    apiKey: '',
    endpoint: 'https://api.openai.com/v1',
    model: 'tts-1',
    voice: 'alloy',
    speed: 1,
    pitch: 1,
    volume: 1
  }
}
```

**å…¨å±€ API é…ç½®ä¿æŒ**ï¼š
- æ–°å»ºé¡¹ç›®æ—¶ä¸è¦†ç›–å…¨å±€ API é…ç½®
- ä¿®æ”¹ï¼š`AppContext.tsx` ä¸­çš„ `setProject` å‡½æ•°

---

### 6. å¯¹è¯æ¡†ç®¡ç†

#### 6.1 Dialog ç»„ä»¶
**åŠŸèƒ½æè¿°**ï¼šç»Ÿä¸€çš„å¯¹è¯æ¡†ç»„ä»¶ï¼Œæ”¯æŒæ‰“å¼€/å…³é—­æ§åˆ¶

**å®ç°ç»†èŠ‚**ï¼š
- ä½¿ç”¨ Radix UI çš„ `Dialog.Root` ç»„ä»¶
- ä½¿ç”¨ `open` å±æ€§è€Œä¸æ˜¯ `defaultOpen`
- æ‰€æœ‰å¯¹è¯æ¡†ç»„ä»¶æ”¯æŒ `isOpen` å’Œ `onClose` props
- å¯¹è¯æ¡†ç±»å‹ï¼š
  - `TextInputPanel` - æ–‡æœ¬è¾“å…¥/åˆ›å»ºé¡¹ç›®
  - `ProjectDialog` - é¡¹ç›®ç®¡ç†
  - `APIConfigDialog` - API é…ç½®
  - `AnimationPreview` - åŠ¨ç”»é¢„è§ˆ
  - `VideoExportDialog` - è§†é¢‘å¯¼å‡º

---

## æŠ€æœ¯æ¶æ„

### å‰ç«¯æ¡†æ¶
- React 18+
- TypeScript
- Vite

### UI ç»„ä»¶
- Radix UI (Dialog, Label, Slider, Select, Tabs, Scroll Area)
- Tailwind CSS
- Lucide React Icons

### çŠ¶æ€ç®¡ç†
- React Context (AppContext)
- æœ¬åœ°å­˜å‚¨ (localStorage)

### æ•°æ®ç»“æ„
```typescript
interface AnimationProject {
  id: string
  name: string
  createdAt: string
  updatedAt: string
  segments: TextSegment[]
  settings: ProjectSettings
  apiConfig: APIConfig | undefined
}

interface TextSegment {
  id: string
  text: string
  prompt?: string
  generatedImages: GeneratedImage[]
  selectedImageIndex?: number
  audio?: AudioFile
  subtitle?: Subtitle
  duration: number
}
```

---

## è°ƒè¯•æ”¯æŒ

### æ—¥å¿—ç³»ç»Ÿ
æ‰€æœ‰ API è°ƒç”¨éƒ½åŒ…å«è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼š

**API å±‚æ—¥å¿—ï¼ˆ`[API]` å‰ç¼€ï¼‰**ï¼š
- å¼€å§‹ç”Ÿæˆ/è¯·æ±‚ä¿¡æ¯
- API è°ƒç”¨è¯¦æƒ…ï¼ˆendpointã€modelã€å‚æ•°ï¼‰
- è¿›åº¦ä¿¡æ¯
- å“åº”æ•°æ®
- é”™è¯¯ä¿¡æ¯

**ç»„ä»¶å±‚æ—¥å¿—ï¼ˆ`[Segment]` å‰ç¼€ï¼‰**ï¼š
- æ“ä½œå¼€å§‹
- æ“ä½œå®Œæˆ
- é”™è¯¯è¯¦æƒ…

### æ—¥å¿—ç¤ºä¾‹
```
[API] å¼€å§‹ç”Ÿæˆç»˜å›¾æç¤ºè¯ {
  provider: 'zhipu',
  model: 'glm-4.5',
  text: 'é€‚å½“æ”¾æ¾åœ°æ–¹...'
}
[API] è°ƒç”¨æ™ºè°±AI {
  endpoint: 'https://open.bigmodel.cn/api/paas/v4/chat/completions',
  model: 'glm-4.5'
}
[API] æ™ºè°±AI å“åº” { data: {...}}
[API] ç»˜å›¾æç¤ºè¯ç”ŸæˆæˆåŠŸ {
  provider: 'zhipu',
  result: 'A peaceful scene...',
  fullResult: 'A peaceful scene...'
}
```

---

## å¾…å®ç°åŠŸèƒ½

æ ¹æ®éœ€æ±‚æ–‡æ¡£ `.monkeycode/specs/text-to-ai-animation-tool/requirements.md`ï¼Œä»¥ä¸‹åŠŸèƒ½å¾…å®ç°ï¼š

### å·²å®ç°
- âœ… éœ€æ±‚1ï¼šæ–‡æœ¬è¾“å…¥åŠŸèƒ½
- âœ… éœ€æ±‚2ï¼šæ–‡æœ¬åˆ°ç»˜å›¾æç¤ºè¯çš„AIå¤„ç†
- âœ… éœ€æ±‚3ï¼šå¤šå›¾ç‰‡ç”Ÿæˆä¸é€‰æ‹©
- âœ… éœ€æ±‚4ï¼šå›¾ç‰‡å°ºå¯¸é…ç½®
- âœ… éœ€æ±‚6ï¼šAPIæœåŠ¡é…ç½®

### éƒ¨åˆ†å®ç°
- ğŸ”„ éœ€æ±‚9ï¼šé¡¹ç›®ç®¡ç†åŠŸèƒ½ï¼ˆåŸºç¡€åŠŸèƒ½å·²å®Œæˆï¼‰

### å¾…å®ç°
- â¬œ éœ€æ±‚5ï¼šå›¾ç”Ÿå›¾ä¸Šä¸‹æ–‡ä¸€è‡´æ€§ï¼ˆå·²å®ç°åŸºç¡€æ”¯æŒï¼Œå¾…ä¼˜åŒ–ï¼‰
- â¬œ éœ€æ±‚7ï¼šæ–‡æœ¬è½¬è¯­éŸ³åŠŸèƒ½ï¼ˆæ¡†æ¶å·²æ­å»ºï¼Œå¾…å®ç°TTSè°ƒç”¨ï¼‰
- â¬œ éœ€æ±‚8ï¼šè¯­éŸ³æ’å…¥åŠ¨ç”»åºåˆ—ï¼ˆæ¡†æ¶å·²æ­å»ºï¼‰
- â¬œ éœ€æ±‚10ï¼šåŠ¨ç”»é¢„è§ˆåŠŸèƒ½ï¼ˆUIå·²å®Œæˆï¼Œå¾…å®Œå–„æ’­æ”¾é€»è¾‘ï¼‰
- â¬œ éœ€æ±‚11ï¼šå­—å¹•åŠŸèƒ½ï¼ˆUIå·²å®Œæˆï¼Œå¾…å®Œå–„ä¿å­˜é€»è¾‘ï¼‰
- â¬œ éœ€æ±‚12ï¼šåŠ¨ç”»åºåˆ—å¯¼å‡º
- â¬œ éœ€æ±‚13ï¼šè§†é¢‘ç”Ÿæˆä¸ä¿å­˜
- â¬œ éœ€æ±‚14ï¼šæ—¶é—´è½´ç¼–è¾‘åŠŸèƒ½
- â¬œ éœ€æ±‚15ï¼šæ‰¹é‡æ–‡æœ¬æ–‡ä»¶å¯¼å…¥

---

## å·²çŸ¥é—®é¢˜

### 1. æ™ºè°±AIå›¾ç‰‡ç”Ÿæˆ
- API è¿”å›çš„æ•°æ®æ ¼å¼å¯èƒ½éœ€è¦è¿›ä¸€æ­¥æµ‹è¯•
- éœ€è¦éªŒè¯ä¸åŒå°ºå¯¸çš„æ”¯æŒæƒ…å†µ

### 2. API é”™è¯¯å¤„ç†
- éƒ¨åˆ† API çš„é”™è¯¯ä¿¡æ¯éœ€è¦æ›´å‹å¥½çš„å±•ç¤º
- ç½‘ç»œè¶…æ—¶å’Œé‡è¯•æœºåˆ¶å¾…å®Œå–„

---

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„ API æä¾›å•†
1. åœ¨ `src/types/index.ts` ä¸­æ·»åŠ  provider ç±»å‹
2. åœ¨ `src/services/api.ts` ä¸­å®ç°è°ƒç”¨æ–¹æ³•
3. åœ¨ `src/components/APIConfigDialog.tsx` ä¸­æ·»åŠ é€‰é¡¹
4. åœ¨å¯¹åº”çš„ switch/case ä¸­æ·»åŠ å¤„ç†é€»è¾‘

### æ·»åŠ æ–°çš„å¯¹è¯æ¡†
1. ä½¿ç”¨ Radix UI çš„ `Dialog.Root` ç»„ä»¶
2. æ·»åŠ  `isOpen` å’Œ `onClose` props
3. åœ¨çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨ `useState` æ§åˆ¶æ˜¾ç¤ºçŠ¶æ€
4. ç¡®ä¿å¯¹è¯æ¡†å§‹ç»ˆåœ¨ç»„ä»¶æ ‘ä¸­æ¸²æŸ“

### è°ƒè¯•æŠ€å·§
- æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹ `[API]` å’Œ `[Segment]` æ—¥å¿—
- ä½¿ç”¨ Network æ ‡ç­¾æŸ¥çœ‹å®é™…çš„ API è¯·æ±‚
- æ£€æŸ¥ localStorage ä¸­çš„æ•°æ®ï¼š`localStorage.getItem('apiConfig')`

---

## ç‰ˆæœ¬å†å²

### v0.1.0 (å½“å‰)
- âœ… é¡¹ç›®åˆ›å»ºå’Œæ‰“å¼€
- âœ… æ–‡æœ¬æ®µè½ç®¡ç†
- âœ… æ™ºè°±AIæ–‡æœ¬åˆ°æç¤ºè¯
- âœ… æ™ºè°±AIæ–‡ç”Ÿå›¾
- âœ… å›¾ç‰‡æ•°é‡å’Œå°ºå¯¸é€‰æ‹©
- âœ… API é…ç½®ç®¡ç†
- âœ… è¯¦ç»†è°ƒè¯•æ—¥å¿—

---

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- é¡¹ç›®ä»“åº“ï¼šhttps://github.com/sffed/aiflow
- æäº¤ Issue
